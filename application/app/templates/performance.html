{% extends "base.html" %}
{% block title %}Performance Analytics{% endblock %}
{% block content %}
<h2><i class="bi bi-graph-up"></i> Performance Analytics</h2>
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header"><h5>Latency by Mode</h5></div>
            <div class="card-body">
                <canvas id="latencyChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header"><h5>Request Distribution</h5></div>
            <div class="card-body">
                <canvas id="requestChart"></canvas>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ stats.total_queries }}</h3>
                <p class="text-muted">Total Queries</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ stats.guardian_redaction_rate }}%</h3>
                <p class="text-muted">PII Detection Rate</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body text-center">
                <h3>{{ stats.avg_similarity_score }}</h3>
                <p class="text-muted">Avg Similarity</p>
            </div>
        </div>
    </div>
</div>
<script>
const latencyData = {{ stats.avg_latency_by_mode | tojson }};
const requestData = {{ stats.request_count_by_mode | tojson }};
new Chart(document.getElementById('latencyChart'), {
    type: 'bar',
    data: {
        labels: Object.keys(latencyData),
        datasets: [{
            label: 'Avg Latency (ms)',
            data: Object.values(latencyData),
            backgroundColor: 'rgba(37, 99, 235, 0.5)'
        }]
    }
});
new Chart(document.getElementById('requestChart'), {
    type: 'pie',
    data: {
        labels: Object.keys(requestData),
        datasets: [{
            data: Object.values(requestData),
            backgroundColor: ['#2563eb', '#10b981', '#f59e0b']
        }]
    }
});
</script>
{% endblock %}
